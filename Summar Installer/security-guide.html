<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Summar Installer 보안 설정 안내</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .lang-btn {
            background: none;
            border: none;
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .lang-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .lang-btn:hover:not(.active) {
            background: #f0f0f0;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #f39c12;
        }
        
        .warning h3 {
            color: #856404;
            margin-top: 0;
        }
        
        .steps {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
            display: inline-block;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        
        .button:hover {
            transform: translateY(-2px);
        }
        
        .keyboard-shortcut {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
            border: 1px solid #ced4da;
        }
        
        .tip {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #17a2b8;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button class="lang-btn active" onclick="switchLanguage('ko')" id="lang-ko">한국어</button>
        <button class="lang-btn" onclick="switchLanguage('en')" id="lang-en">English</button>
    </div>

    <div class="container">
        <!-- Korean Content -->
        <div id="content-ko" class="language-content">
            <div class="header">
                <div class="logo">S</div>
                <h1>Summar Installer 실행 안내</h1>
                <p class="subtitle">macOS 보안 설정으로 인해 추가 설정이 필요합니다</p>
            </div>
            
            <div class="warning">
                <h3>⚠️ MDM 또는 Gatekeeper로 인한 차단</h3>
                <p>Summar Installer가 macOS의 보안 정책에 의해 차단되었습니다. 아래 단계를 따라 앱을 허용해주세요.</p>
            </div>
            
            <div class="steps">
                <h3>📋 해결 방법</h3>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>⚡ 가장 빠른 방법 (추천)</strong><br>
                    DMG에서 <strong>Summar Installer.app을 우클릭</strong> → <strong>"열기"</strong> 선택 → 보안 대화상자에서 <strong>"열기"</strong> 클릭
                    <br><br>
                    <button class="button" onclick="showQuickMethod()">⚡ 빠른 방법 상세보기</button>
                </div>
                
                <div class="step">
                    <span class="step-number">2</span>
                    <strong>시스템 설정을 통한 방법</strong><br>
                    <span class="keyboard-shortcut">⌘ + Space</span>를 누르고 "시스템 설정" 입력 후 Enter
                    <br><br>
                    또는 아래 버튼을 클릭하세요:
                    <br>
                    <button class="button" onclick="openSystemPreferences()">🔧 시스템 설정 열기</button>
                </div>
                
                <div class="step">
                    <span class="step-number">3</span>
                    <strong>개인정보 보호 및 보안 찾기</strong><br>
                    좌측 사이드바에서 "개인정보 보호 및 보안" 클릭
                </div>
                
                <div class="step">
                    <span class="step-number">4</span>
                    <strong>보안 섹션 확인</strong><br>
                    "보안" 섹션에서 "Summar Installer"에 대한 알림을 찾습니다
                </div>
                
                <div class="step">
                    <span class="step-number">5</span>
                    <strong>앱 허용</strong><br>
                    "확인 없이 열기" 또는 "열기" 버튼을 클릭하여 Summar Installer를 허용합니다
                </div>
                
                <div class="step">
                    <span class="step-number">6</span>
                    <strong>Summar Installer 재실행</strong><br>
                    DMG에서 Summar Installer.app을 다시 실행합니다
                </div>
            </div>
            
            <div class="steps">
                <h3>🛠️ 고급 해결 방법</h3>
                
                <div class="step">
                    <strong>터미널을 통한 임시 해결</strong><br>
                    극단적인 경우에만 사용하세요:
                    <br><br>
                    1. 터미널 열기 (<span class="keyboard-shortcut">⌘ + Space</span> → "터미널")
                    <br>
                    2. 다음 명령어 입력: <code style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">sudo spctl --master-disable</code>
                    <br>
                    3. Summar Installer 실행
                    <br>
                    4. 실행 후 보안 복원: <code style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">sudo spctl --master-enable</code>
                    <br><br>
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 3px solid #f44336;">
                        <strong>⚠️ 주의:</strong> 이 방법은 시스템 보안을 일시적으로 비활성화합니다. 반드시 앱 실행 후 보안을 다시 활성화하세요.
                    </div>
                </div>
            </div>
            
            <div class="tip">
                <h4>💡 문제 해결 팁</h4>
                <ul>
                    <li><strong>앱이 계속 차단되는 경우:</strong> 시스템을 재부팅하고 다시 시도해보세요</li>
                    <li><strong>MDM 환경:</strong> 회사/학교 컴퓨터라면 IT 관리자에게 문의하세요</li>
                    <li><strong>오래된 macOS:</strong> macOS 12.0 이상 권장</li>
                    <li><strong>다른 방법:</strong> Obsidian Community Plugins에서 "Summar" 검색하여 직접 설치</li>
                </ul>
            </div>
            
            <div class="steps">
                <h3>📖 설치 완료 후 사용법</h3>
                
                <div class="step">
                    <strong>1. Summar Installer 실행</strong><br>
                    보안 설정 완료 후 Summar Installer.app을 실행하면 자동으로 Obsidian 플러그인이 설치됩니다.
                </div>
                
                <div class="step">
                    <strong>2. Obsidian에서 활성화</strong><br>
                    Obsidian → 설정 → 커뮤니티 플러그인 → "Summar" 활성화
                </div>
                
                <div class="step">
                    <strong>3. API 키 설정</strong><br>
                    OpenAI API 키를 설정하여 AI 기능을 사용할 수 있습니다.
                </div>
            </div>
            
            <div class="success">
                <h4>✅ 성공적으로 설정하면</h4>
                <p>Summar Installer가 정상적으로 실행되어 Obsidian 플러그인을 자동으로 설치할 수 있습니다.</p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="button" onclick="openSystemPreferences()">🔧 시스템 설정 열기</button>
                <button class="button" onclick="testAppExecution()">🧪 앱 실행 테스트</button>
                <button class="button" onclick="showAllMethods()">📋 모든 방법 보기</button>
                <button class="button" onclick="window.close()">✅ 이해했습니다</button>
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <p style="margin: 0; color: #6c757d; font-size: 14px;">
                    <strong>문제가 지속되나요?</strong><br>
                    GitHub 이슈: <a href="https://github.com/mcgabby/Summar/issues" target="_blank" style="color: #667eea;">github.com/mcgabby/Summar/issues</a><br>
                    수동 설치: Obsidian → 설정 → 커뮤니티 플러그인 → "Summar" 검색
                </p>
            </div>
        </div>

        <!-- English Content -->
        <div id="content-en" class="language-content" style="display: none;">
            <div class="header">
                <div class="logo">S</div>
                <h1>Summar Installer Setup Guide</h1>
                <p class="subtitle">Additional setup required due to macOS security settings</p>
            </div>
            
            <div class="warning">
                <h3>⚠️ Blocked by MDM or Gatekeeper</h3>
                <p>Summar Installer has been blocked by macOS security policies. Please follow the steps below to allow the app.</p>
            </div>
            
            <div class="steps">
                <h3>📋 Resolution Methods</h3>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>⚡ Fastest Method (Recommended)</strong><br>
                    In the DMG, <strong>right-click Summar Installer.app</strong> → select <strong>"Open"</strong> → click <strong>"Open"</strong> in the security dialog
                    <br><br>
                    <button class="button" onclick="showQuickMethod()">⚡ View Quick Method Details</button>
                </div>
                
                <div class="step">
                    <span class="step-number">2</span>
                    <strong>System Settings Method</strong><br>
                    Press <span class="keyboard-shortcut">⌘ + Space</span> and type "System Settings" then press Enter
                    <br><br>
                    Or click the button below:
                    <br>
                    <button class="button" onclick="openSystemPreferences()">🔧 Open System Settings</button>
                </div>
                
                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Find Privacy & Security</strong><br>
                    Click "Privacy & Security" in the left sidebar
                </div>
                
                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Check Security Section</strong><br>
                    Look for notifications about "Summar Installer" in the "Security" section
                </div>
                
                <div class="step">
                    <span class="step-number">5</span>
                    <strong>Allow App</strong><br>
                    Click "Open Anyway" or "Allow" button to permit Summar Installer
                </div>
                
                <div class="step">
                    <span class="step-number">6</span>
                    <strong>Re-run Summar Installer</strong><br>
                    Run Summar Installer.app again from the DMG
                </div>
            </div>
            
            <div class="steps">
                <h3>🛠️ Advanced Resolution Method</h3>
                
                <div class="step">
                    <strong>Temporary Resolution via Terminal</strong><br>
                    Use only in extreme cases:
                    <br><br>
                    1. Open Terminal (<span class="keyboard-shortcut">⌘ + Space</span> → "Terminal")
                    <br>
                    2. Enter command: <code style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">sudo spctl --master-disable</code>
                    <br>
                    3. Run Summar Installer
                    <br>
                    4. Restore security after running: <code style="background: #f1f1f1; padding: 2px 6px; border-radius: 3px;">sudo spctl --master-enable</code>
                    <br><br>
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 3px solid #f44336;">
                        <strong>⚠️ Warning:</strong> This method temporarily disables system security. Make sure to re-enable security after running the app.
                    </div>
                </div>
            </div>
            
            <div class="tip">
                <h4>💡 Troubleshooting Tips</h4>
                <ul>
                    <li><strong>If app continues to be blocked:</strong> Try restarting your system and try again</li>
                    <li><strong>MDM environment:</strong> If this is a company/school computer, contact your IT administrator</li>
                    <li><strong>Older macOS:</strong> macOS 12.0 or later recommended</li>
                    <li><strong>Alternative method:</strong> Search for "Summar" in Obsidian Community Plugins for direct installation</li>
                </ul>
            </div>
            
            <div class="steps">
                <h3>📖 Post-Installation Usage</h3>
                
                <div class="step">
                    <strong>1. Run Summar Installer</strong><br>
                    After completing security setup, run Summar Installer.app to automatically install the Obsidian plugin.
                </div>
                
                <div class="step">
                    <strong>2. Enable in Obsidian</strong><br>
                    Obsidian → Settings → Community Plugins → Enable "Summar"
                </div>
                
                <div class="step">
                    <strong>3. Configure API Key</strong><br>
                    Set up your OpenAI API key to use AI features.
                </div>
            </div>
            
            <div class="success">
                <h4>✅ Upon Successful Setup</h4>
                <p>Summar Installer will run normally and automatically install the Obsidian plugin.</p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="button" onclick="openSystemPreferences()">🔧 Open System Settings</button>
                <button class="button" onclick="testAppExecution()">🧪 Test App Execution</button>
                <button class="button" onclick="showAllMethods()">📋 Show All Methods</button>
                <button class="button" onclick="window.close()">✅ Got It</button>
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <p style="margin: 0; color: #6c757d; font-size: 14px;">
                    <strong>Issues persisting?</strong><br>
                    GitHub Issues: <a href="https://github.com/mcgabby/Summar/issues" target="_blank" style="color: #667eea;">github.com/mcgabby/Summar/issues</a><br>
                    Manual Installation: Obsidian → Settings → Community Plugins → Search "Summar"
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // 다국어 지원 설정
        let currentLanguage = 'ko';
        
        // 언어별 메시지 정의
        const messages = {
            ko: {
                quickMethod: `⚡ 가장 빠른 해결 방법:

1. DMG 창으로 돌아가기
2. 'Summar Installer.app'을 우클릭 (또는 Control + 클릭)
3. 메뉴에서 '열기' 선택
4. 경고 창에서 '열기' 버튼 클릭

이 방법이 90% 경우에서 가장 빠르게 해결됩니다!`,
                
                allMethods: `🔐 Summar Installer 차단 해결 - 모든 방법

방법 1 (추천): 우클릭으로 열기
• Summar Installer.app 우클릭 → "열기"

방법 2: 시스템 설정 수정  
• 시스템 설정 → 개인정보 보호 및 보안 → 보안
• "Summar Installer" 관련 알림에서 "열기" 클릭

방법 3: 터미널 (고급)
• sudo spctl --master-disable
• 앱 실행 후 sudo spctl --master-enable

방법 4: 수동 설치
• Obsidian → 설정 → 커뮤니티 플러그인 → "Summar" 검색

선택하신 방법으로 진행하세요!`,
                
                testApp: "Summar Installer.app을 지금 테스트해볼까요?\n\n'확인'을 누르면 앱 실행을 시도합니다.\n(차단되면 보안 설정 창이 나타납니다)",
                
                testAppInstructions: "DMG 창에서 'Summar Installer.app'을 더블클릭하여 실행해보세요.\n\n차단되면 이 가이드로 다시 돌아와서 보안 설정을 변경하세요.",
                
                manualInstructions: `자동으로 시스템 설정을 열 수 없습니다.

수동으로 다음 단계를 따라하세요:

1. ⌘ + Space를 누르고 "시스템 설정" 검색
2. "개인정보 보호 및 보안" 클릭  
3. "보안" 섹션에서 Summar Installer 관련 알림 찾기
4. "확인 없이 열기" 또는 "열기" 클릭

또는 Summar Installer.app을 우클릭하고 "열기"를 선택하세요.`,
                
                welcomeMessage: `🔐 Summar Installer 보안 설정 도우미

Summar Installer가 macOS 보안 정책으로 차단되었나요?

'확인': 자동으로 시스템 설정 열기
'취소': 수동 해결 방법 계속 보기`
            },
            
            en: {
                quickMethod: `⚡ Fastest Resolution Method:

1. Return to the DMG window
2. Right-click 'Summar Installer.app' (or Control + click)
3. Select 'Open' from the menu
4. Click 'Open' button in the warning dialog

This method resolves the issue in 90% of cases!`,
                
                allMethods: `🔐 Summar Installer Block Resolution - All Methods

Method 1 (Recommended): Right-click to open
• Right-click Summar Installer.app → "Open"

Method 2: System Settings modification
• System Settings → Privacy & Security → Security
• Click "Open" in "Summar Installer" related notification

Method 3: Terminal (Advanced)
• sudo spctl --master-disable
• Run app then sudo spctl --master-enable

Method 4: Manual installation
• Obsidian → Settings → Community Plugins → Search "Summar"

Proceed with your chosen method!`,
                
                testApp: "Would you like to test Summar Installer.app now?\n\n'OK' will attempt to run the app.\n(If blocked, security settings dialog will appear)",
                
                testAppInstructions: "Double-click 'Summar Installer.app' in the DMG window to run it.\n\nIf blocked, return to this guide to change security settings.",
                
                manualInstructions: `Unable to automatically open System Settings.

Please follow these steps manually:

1. Press ⌘ + Space and search "System Settings"
2. Click "Privacy & Security"
3. Find Summar Installer related notification in "Security" section
4. Click "Open Anyway" or "Open"

Or right-click Summar Installer.app and select "Open".`,
                
                welcomeMessage: `🔐 Summar Installer Security Setup Helper

Has Summar Installer been blocked by macOS security policies?

'OK': Automatically open System Settings
'Cancel': Continue with manual resolution methods`
            }
        };
        
        // 언어 전환 함수
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // 모든 언어 콘텐츠 숨기기
            document.querySelectorAll('.language-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // 선택된 언어 콘텐츠 보이기
            document.getElementById(`content-${lang}`).style.display = 'block';
            
            // 언어 버튼 상태 업데이트
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // 페이지 제목 업데이트
            document.getElementById('page-title').textContent = 
                lang === 'ko' ? 'Summar Installer 보안 설정 안내' : 'Summar Installer Security Setup Guide';
            
            // HTML lang 속성 업데이트
            document.documentElement.lang = lang;
            
            // 로컬 스토리지에 언어 설정 저장
            localStorage.setItem('summar-installer-language', lang);
        }
        
        // 시스템 언어 감지 및 초기 언어 설정
        function detectAndSetLanguage() {
            // 로컬 스토리지에서 저장된 언어 확인
            const savedLanguage = localStorage.getItem('summar-installer-language');
            if (savedLanguage) {
                switchLanguage(savedLanguage);
                return;
            }
            
            // 브라우저 언어 감지
            const browserLanguage = navigator.language || navigator.languages[0];
            const isKorean = browserLanguage.startsWith('ko');
            
            // 한국어면 한국어로, 아니면 영어로 설정
            switchLanguage(isKorean ? 'ko' : 'en');
        }
        
        function openSystemPreferences() {
            // macOS에서 시스템 설정 열기
            try {
                // Method 1: URL 스킴을 통한 직접 열기 (macOS Ventura+)
                const isVenturaOrLater = navigator.userAgent.includes('Mac OS X 10_15') === false;
                
                if (isVenturaOrLater) {
                    // macOS Ventura 이후 새로운 시스템 설정
                    window.location.href = "x-apple.systempreferences:com.apple.preference.security?Privacy_Security";
                } else {
                    // 이전 버전 시스템 환경설정
                    window.location.href = "x-apple.systempreferences:com.apple.preference.security";
                }
                
                // 성공 메시지 표시
                setTimeout(() => {
                    showSuccessMessage();
                }, 1000);
                
            } catch (e) {
                console.error("자동 열기 실패:", e);
                showManualInstructions();
            }
        }
        
        function showSuccessMessage() {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            
            if (currentLanguage === 'ko') {
                successDiv.innerHTML = `
                    <h4>✅ 시스템 설정이 열렸습니다!</h4>
                    <p>이제 다음 단계를 따라하세요:</p>
                    <ol>
                        <li>"개인정보 보호 및 보안" 클릭</li>
                        <li>"보안" 섹션에서 "Summar Installer" 찾기</li>
                        <li>"확인 없이 열기" 또는 "열기" 클릭</li>
                        <li>DMG에서 Summar Installer.app 재실행</li>
                    </ol>
                `;
            } else {
                successDiv.innerHTML = `
                    <h4>✅ System Settings opened!</h4>
                    <p>Now follow these steps:</p>
                    <ol>
                        <li>Click "Privacy & Security"</li>
                        <li>Find "Summar Installer" in "Security" section</li>
                        <li>Click "Open Anyway" or "Open"</li>
                        <li>Re-run Summar Installer.app from DMG</li>
                    </ol>
                `;
            }
            
            document.querySelector('.container').appendChild(successDiv);
        }
        
        function showManualInstructions() {
            alert(messages[currentLanguage].manualInstructions);
        }
        
        function testAppExecution() {
            const testResult = confirm(messages[currentLanguage].testApp);
            
            if (testResult) {
                alert(messages[currentLanguage].testAppInstructions);
            }
        }
        
        function showQuickMethod() {
            alert(messages[currentLanguage].quickMethod);
        }
        
        function showAllMethods() {
            alert(messages[currentLanguage].allMethods);
        }
        
        function copyTerminalCommand(command) {
            navigator.clipboard.writeText(command).then(() => {
                const message = currentLanguage === 'ko' 
                    ? `명령어가 클립보드에 복사되었습니다:\n${command}\n\n터미널에 붙여넣기하세요.`
                    : `Command copied to clipboard:\n${command}\n\nPaste it in Terminal.`;
                alert(message);
            }).catch(() => {
                const message = currentLanguage === 'ko' 
                    ? "다음 명령어를 복사하세요:"
                    : "Copy this command:";
                prompt(message, command);
            });
        }
        
        // 페이지 로드 시 언어 감지 및 설정
        window.addEventListener('load', function() {
            detectAndSetLanguage();
            
            // 3초 후에 자동 프롬프트 표시
            setTimeout(() => {
                const userChoice = confirm(messages[currentLanguage].welcomeMessage);
                
                if (userChoice) {
                    openSystemPreferences();
                }
            }, 2000);
        });
    </script>
</body>
</html>
